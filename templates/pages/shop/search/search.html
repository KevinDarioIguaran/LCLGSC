{% extends 'layouts/base.html' %}
{% load humanize %}
{% load static %}

{% block title %}Resultados de Búsqueda{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'styles/pages/shop/search/search.css' %}">
{% endblock %}

{% block content %}
    {% include 'components/navbar/navbar.html' %}

    <main class="results-page">
        <section class="results-container">
            <header class="results-header">
                <h1 class="results-header__title">{{ search_query|default:"Resultados" }}</h1>
            </header>

            {% if search_results %}
                <div class="product-grid">
                    {% for product in search_results %}
                        <a href="{{ product.get_absolute_url }}" class="product-card__link">
                            <article class="product-card">
                                <figure class="product-card__image-container">
                                    <img 
                                        src="{% if product.get_image_url %}{{ product.get_image_url }}{% else %}{% static 'img/no_image.png' %}{% endif %}" 
                                        alt="Imagen de {{ product.name }}" 
                                        class="product-card__image"
                                        loading="lazy"
                                    >
                                    {% if product.offer_active and product.discount_percent > 0 %}
                                        <span class="product-discount-badge">-{{ product.discount_percent }}%</span>
                                    {% endif %}
                                </figure>
                                <div class="product-card__info">
                                    <span class="product-card__seller">{{ product.seller.get_cooperative_name }}</span>
                                    <h3 class="product-card__name">{{ product.name }}</h3>
                                    {% if product.offer_active and product.get_final_price != product.price %}
                                        <div class="price-info">
                                            <p class="cart__box-price-original">{{ product.price|floatformat:0|intcomma }} COP</p>
                                            <p class="cart__box-price">{{ product.get_final_price|floatformat:0|intcomma }} COP</p>
                                        </div>
                                    {% else %}
                                        <p class="cart__box-price-normal">{{ product.price|floatformat:0|intcomma }} COP</p>
                                    {% endif %}
                                </div>
                            </article>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="results-empty">
                    <p class="results-empty__message">{{ results_empty|default:"No se encontraron productos que coincidan con tu búsqueda." }}</p>
                    <a href="{% url 'home:home' %}" class="results-empty__link">Volver al inicio</a>
                </div>
            {% endif %}
        </section>
    </main>
{% endblock %}
